syntax = "proto3";

package pix.payment.v1;

option go_package = "github.com/example/pix/proto/gen/go/payment/v1;paymentv1";
option java_package = "com.example.pix.payment.v1";
option java_multiple_files = true;
option csharp_namespace = "Pix.Payment.V1";

// PaymentState represents the lifecycle state of a payment.
enum PaymentState {
  PAYMENT_STATE_UNSPECIFIED = 0;
  PAYMENT_STATE_CREATED     = 1;
  PAYMENT_STATE_VALIDATING  = 2;
  PAYMENT_STATE_SUBMITTED   = 3;
  PAYMENT_STATE_SETTLED     = 4;
  PAYMENT_STATE_FAILED      = 5;
  PAYMENT_STATE_REVERSING   = 6;
  PAYMENT_STATE_REVERSED    = 7;
}

// Payment is the core payment record.
message Payment {
  string       id              = 1;
  PaymentState state           = 2;
  string       payer_key       = 3;
  string       payee_key       = 4;
  // Amount in centavos (1 BRL = 100 centavos). Range: 1 â€“ 99999999999.
  int64        amount_centavos = 5;
  string       idempotency_key = 6;
  string       spi_end_to_end_id = 7;
  string       rejection_reason   = 8;
  int64        created_at_unix    = 9;
  int64        updated_at_unix    = 10;
}

// CreatePaymentRequest initiates an outbound PIX payment.
message CreatePaymentRequest {
  string payer_key        = 1;
  string payee_key        = 2;
  int64  amount_centavos  = 3;
  string idempotency_key  = 4;
}

message CreatePaymentResponse {
  Payment payment = 1;
}

// GetPaymentRequest fetches a payment by its internal ID.
message GetPaymentRequest {
  string id = 1;
}

message GetPaymentResponse {
  Payment payment = 1;
}

// ListPaymentsRequest lists payments with optional state filter and cursor pagination.
message ListPaymentsRequest {
  PaymentState state_filter = 1; // UNSPECIFIED = no filter
  string       cursor       = 2;
  int32        page_size    = 3; // default 20, max 100
}

message ListPaymentsResponse {
  repeated Payment payments    = 1;
  string           next_cursor = 2;
}

// SubmitToSPIRequest triggers SPI submission for a payment in CREATED state.
message SubmitToSPIRequest {
  string payment_id = 1;
}

message SubmitToSPIResponse {
  Payment payment = 1;
}

// ReceiveInboundCreditRequest handles an inbound PIX credit from SPI.
message ReceiveInboundCreditRequest {
  string spi_end_to_end_id = 1;
  string payer_key         = 2;
  string payee_key         = 3;
  int64  amount_centavos   = 4;
}

message ReceiveInboundCreditResponse {
  Payment payment = 1;
}

// PaymentService exposes payment operations over gRPC.
service PaymentService {
  rpc CreatePayment        (CreatePaymentRequest)        returns (CreatePaymentResponse);
  rpc GetPayment           (GetPaymentRequest)           returns (GetPaymentResponse);
  rpc ListPayments         (ListPaymentsRequest)         returns (ListPaymentsResponse);
  rpc SubmitToSPI          (SubmitToSPIRequest)          returns (SubmitToSPIResponse);
  rpc ReceiveInboundCredit (ReceiveInboundCreditRequest) returns (ReceiveInboundCreditResponse);
}
